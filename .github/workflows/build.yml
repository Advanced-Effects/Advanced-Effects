# This piece of code was made by ChatGPT because I don't care enough to learn this

name: Build project

on:
        push:
                branches: [main]
        pull_request:

jobs:
        build:
                runs-on: ubuntu-latest

                steps:
                        - name: üì• Checkout repository
                          uses: actions/checkout@v4

                        - name: Cache APT Packages
                          uses: awalsh128/cache-apt-pkgs-action@v1.5.3
                          with:
                                  packages: cmake ninja-build clang g++ mesa-utils libglu1-mesa-dev freeglut3-dev mesa-common-dev libglew-dev libglfw3-dev libglm-dev libfontconfig1-dev libfreetype-dev libjpeg-turbo8-dev libpng-dev libwebp-dev libharfbuzz-dev libicu-dev libarchive-dev libavcodec-dev libavutil-dev libavformat-dev libswscale-dev

                        - name: Cache Qt
                          uses: actions/cache@v4
                          with:
                                  path: /home/runner/Qt
                                  key: ${{ runner.os }}-qt-${{ hashFiles('**/*') }}
                                  restore-keys: |
                                          ${{ runner.os }}-qt-

                        - name: Check if Qt is cached or not
                          id: check_dir
                          run: |
                                  if [ ! -d "~/Qt" ]; then
                                        echo "Qt is not installed"
                                        echo "::set-output name=qt_exists::false"
                                  else
                                        echo "Qt is installed."
                                        echo "::set-output name=qt_exists::true"
                                  fi

                        - name: Get Qt framework
                          if: steps.check_dir.outputs.qt_exists == 'false'
                          uses: jurplel/install-qt-action@v4
                          with:
                                  version: 6.9.1
                                  modules: qtnetworkauth qt5compat

                        - name: ‚öôÔ∏è Set up dependencies
                          run: |
                                  sudo apt-get update
                                  sudo apt-get install -y cmake ninja-build clang
                                  sudo apt-get install -y mesa-utils libglu1-mesa-dev freeglut3-dev mesa-common-dev
                                  sudo apt-get install -y libglew-dev libglfw3-dev libglm-dev
                                  sudo apt-get install -y libfontconfig1-dev libfreetype-dev libjpeg-turbo8-dev libpng-dev libwebp-dev
                                  sudo apt-get install -y libharfbuzz-dev libicu-dev
                                  sudo apt-get install -y libavcodec-dev libavutil-dev libavformat-dev libswscale-dev
                                  sudo apt-get install -y python3 python3-pip

                        - name: Cache build directory
                          uses: actions/cache@v4
                          with:
                                  path: build/
                                  key: ${{ runner.os }}-build-${{ hashFiles('**/CMakeLists.txt', '**/*.cpp') }}
                                  restore-keys: |
                                          ${{ runner.os }}-build-

                        - name: üèóÔ∏è Configure and build
                          run: |
                                  mkdir -p build
                                  cd build
                                  cmake -G Ninja \
                                  -DCMAKE_C_COMPILER=clang \
                                  -DCMAKE_CXX_COMPILER=clang++ \
                                  -DPYTHON_EXECUTABLE=/usr/bin/python3 \
                                  ..
                                  cmake --build . -j$(nproc)

                        - name: üì¶ Upload executable
                          uses: actions/upload-artifact@v4
                          with:
                                  name: AdvancedEffects
                                  path: |
                                          build/src/app/AdvancedEffects
                                  if-no-files-found: error
